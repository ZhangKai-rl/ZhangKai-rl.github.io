![](Pasted%20image%2020230326142630.png)
==多线程执行查询==

![](Pasted%20image%2020230326142946.png)
throughput：吞吐量

![](Pasted%20image%2020230326143034.png)
分布式和并行
![](Pasted%20image%2020230326143353.png)


![](Pasted%20image%2020230326143442.png)

# 线程处理模型

这是针对多条sql语句

![](Pasted%20image%2020230326144443.png)
![](Pasted%20image%2020230326144521.png)
1. 每个worker一个进程
2. 进程池
3. 每个worker一个线程

![](Pasted%20image%2020230326144809.png)
会频繁创建销毁进程
![](Pasted%20image%2020230326144837.png)
但进程还是大，通信也不方便
![](Pasted%20image%2020230326144915.png)
![](Pasted%20image%2020230326145200.png)
上下文切换小天然共享内存。
多条sql语句使用不同的线程，并不是单个sql语句内多线程并行。

调度
![](Pasted%20image%2020230326145350.png)
最后一句的意思是：dbms比os知道的多，因此我们要尽量使用dbms来完成这些调度任务
# 执行并行

![](Pasted%20image%2020230326145550.png)
查询间并行和查询内部并行。
![](Pasted%20image%2020230326145700.png)
允许多个查询同时进行。
![](Pasted%20image%2020230326150705.png)
类似于生产者消费者。提高单条sql的速度。

![](Pasted%20image%2020230326150840.png)
## INTRA-QUERY PARALLELISM

![](Pasted%20image%2020230326151021.png)
三种查询内部并行方式：
### Intra-Operator（水平）
![](Pasted%20image%2020230326151045.png)
将总的数据进行拆分，每个线程干一样的任务
![](Pasted%20image%2020230326151239.png)
不同线程负责不同的页。exchange算子负责汇聚拆分
![](Pasted%20image%2020230326151344.png)
exchange operater算子分为三种。
![](Pasted%20image%2020230326151704.png)
使用的hash join

### Inter-operator（垂直）

![](Pasted%20image%2020230326152012.png)
数据不切分，对处理过程进行切分，线程做的工作不一样。
![](Pasted%20image%2020230326152039.png)
类似于流式，流水线。

### BUSHY PARALLELISM

前两种结合
![](Pasted%20image%2020230326152158.png)

![](Pasted%20image%2020230326152409.png)
但是我们这门课是面向磁盘的数据库
之前并行的是在内存，并不是大头。
因此最重要的是IO 并行

# IO parallelism

![](Pasted%20image%2020230326152559.png)
relation是表
![](Pasted%20image%2020230326152815.png)
这是os控制的， 数据库认为数据存在一个磁盘上。对dbms透明。
可以进行并行读写。 扩展了容量

![](Pasted%20image%2020230326153925.png)
分库
![](Pasted%20image%2020230326154011.png)
分区/分表

![](Pasted%20image%2020230326154055.png)
![](Pasted%20image%2020230326154211.png)


![](Pasted%20image%2020230326154423.png)

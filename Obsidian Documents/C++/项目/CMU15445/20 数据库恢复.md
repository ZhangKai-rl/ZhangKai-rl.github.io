![](Pasted%20image%2020230528000253.png)
恢复包括两大块：
- 事务正常运行的时候需要做哪些工作？（上节课WAL）

![](Pasted%20image%2020230528000419.png)
![](Pasted%20image%2020230528001000.png)
![](Pasted%20image%2020230528001330.png)

>checkpoints的问题 

![](Pasted%20image%2020230528001601.png)

![](Pasted%20image%2020230528001617.png)
太频繁性能下降，太长时间会刷盘时间太久。

# 课程内容

![](Pasted%20image%2020230528001838.png)

![](Pasted%20image%2020230528002337.png)


# ARIES

![](Pasted%20image%2020230528001925.png)

主要内容
![](Pasted%20image%2020230528002116.png)

# LSN

![](Pasted%20image%2020230528002520.png)
![](Pasted%20image%2020230528002816.png)

![](Pasted%20image%2020230528003804.png)

![](Pasted%20image%2020230528004415.png)
是否可以进行该页刷脏？
![](Pasted%20image%2020230528004359.png)

![](Pasted%20image%2020230528004703.png)

# 正常运行

## commit

![](Pasted%20image%2020230528004829.png)
![](Pasted%20image%2020230528004949.png)
TXN-END应该是代表日志已经落盘成功。
![](Pasted%20image%2020230528005202.png)
![](Pasted%20image%2020230528005211.png)
![](Pasted%20image%2020230528005338.png)


## abort

![](Pasted%20image%2020230528005428.png)
![](Pasted%20image%2020230528005612.png)

![](Pasted%20image%2020230528005716.png)
![](Pasted%20image%2020230528010047.png)

![](Pasted%20image%2020230528010127.png)

![](Pasted%20image%2020230528010244.png)

# fuzzy checkpointing

![](Pasted%20image%2020230528010311.png)
![](Pasted%20image%2020230528010533.png)
由不允许任何修改，变成加锁，不允许对刷脏的页进行修改
![](Pasted%20image%2020230528010654.png)

## ATT

![](Pasted%20image%2020230528010925.png)

## DPT

![](Pasted%20image%2020230528011128.png)


![](Pasted%20image%2020230528011607.png)
做到了可以不清空缓存池脏页，但是仍然必须暂停事务。


![](Pasted%20image%2020230528011834.png)
由精确的checkpoints时间点变成时间段。 

![](Pasted%20image%2020230528012141.png)

# ARIES-恢复算法

![](Pasted%20image%2020230528012355.png)

## 总体过程

![](Pasted%20image%2020230528012810.png)

## 分析阶段

![](Pasted%20image%2020230528013059.png)
![](Pasted%20image%2020230528013137.png)
![](Pasted%20image%2020230528013425.png)

## redo阶段

![](Pasted%20image%2020230528013714.png)
![](Pasted%20image%2020230528013812.png)
![](Pasted%20image%2020230528014007.png)


## undo

![](Pasted%20image%2020230528014135.png)


![](Pasted%20image%2020230528014319.png)


![](Pasted%20image%2020230528014807.png)
![](Pasted%20image%2020230528014926.png)

# 总结

![](Pasted%20image%2020230528015109.png)
